@{
    ViewBag.Title = "About";
}
<div class="row">
    <div class="col-md-6">
        <h1 id="eventTitle" style="width:auto;
                    height: 100%;
                    font-family: Verdana;
                    font-size: 25px;
                    top: 110px;
                    padding: 0px 0px 30px 0px;
                    vertical-align: middle;">
            Titel_evenement
        </h1>
    </div>

    <div class="col-md-6">
        <div id="map"></div>
    </div>
</div>
@section scripts {
<script>
    var destination = { lat: 0, lng: 0 };

    var parkings = @Html.Raw(ViewBag.ParkingList);


    $(document).ready(function () {
        $.ajax({
            url: "https://app.ticketmaster.com/discovery/v2/events.json?countryCode=nl&apikey=KTmwKGyLJSOws2LFF9Al78erEjIRRF1u&id=" + "@ViewBag.id",
            success: function (result) {
                //Event name
                $('#eventTitle').html(result['_embedded']['events'][0]['name'])

                //Event image
                //$('#eventImage').attr('src', result['_embedded']['events'][0]['images'][0]['url'])

                //Long lat on google maps
                var long = result['_embedded']['events'][0]['_embedded']['venues'][0]['location']['longitude'];
                var lat = result['_embedded']['events'][0]['_embedded']['venues'][0]['location']['latitude'];
                var destination = { lat: parseFloat(lat), lng: parseFloat(long) }
                console.log(destination);

                var lat2 = parkings[3]["lat"].replace(',', '.');
                var long2 = parkings[3]["lng"].replace(',', '.');
                var c = { lat: parseFloat(lat2), lng: parseFloat(long2) };


                var request = {
                    destination: destination,
                    origin: c,
                    travelMode: 'TRANSIT'

                };

                var map = new google.maps.Map(document.getElementById('map'), {
                    center: destination,
                    zoom: 12
                });

                var directionsDisplay = new google.maps.DirectionsRenderer({
                    map: map
                });

                var nearestParking;
                // Pass the directions request to the directions service.
                var directionsService = new google.maps.DirectionsService();
                for (var i = 0; i < parkings.length; i++) {
                    var parkLat = parkings[i]["lat"].replace(',', '.');
                    var parkLng = parkings[i]["lng"].replace(',', '.');
                    var origin = { lat: parseFloat(parkLat), lng: parseFloat(parkLng) };
                    var request = {
                        destination: destination,
                        origin: origin,
                        travelMode: 'TRANSIT'

                    };
                    console.log("request");
                    console.log(request);


                    directionsService.route(request, function (response, status) {
                        if (status == 'OK') {
                            console.log("response");
                            console.log(response);

                            // Display the route on the map.
                            if (nearestParking == null) {
                                console.log("nearestparking initial")
                                nearestParking = response;
                            }
                            else if (nearestParking["routes"][0]["legs"][0]["duration"]["value"] > response["routes"][0]["legs"][0]["duration"]["value"]) {
                                nearestParking = response;
                                console.log("overwrite nearest parking")
                            }
                            directionsDisplay.setDirections(nearestParking);
   
                        }
                    });

                }


                // description
                $("#omschrijving").html(result['_embedded']['events'][0]['name'] + "<br /> Datum: " + result['_embedded']['events'][0]['dates']['start']['localDate'] + " " + result['_embedded']['events'][0]['dates']['start']['localTime'] + " <br /> <a href=\"" + result['_embedded']['events'][0]['url'] + "\"> Koop hier uw tickets! </a>");
            }
        })
    });

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSjtaS93EaAoM3iB9FSMcx-8ZqxcWSAw4"
        async defer></script>
}
